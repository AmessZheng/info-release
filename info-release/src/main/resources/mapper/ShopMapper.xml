<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhuxn.inforelease.orm.mapper.ShopMapper">
    <resultMap id="ShopResultMap" type="Shop">
        <id column="id" property="id" />
        <result column="create_time" property="createTime" />
        <result column="name" property="name" />
        <result column="telephone" property="telephone" />
        <result column="address" property="address" />
        <result column="desc" property="desc" />
        <result column="cover_img" property="coverImg" />
        <result column="content" property="content" />
        <result column="category" property="category" />
        <result column="is_top" property="isTop" />
        <result column="is_deleted" property="isDeleted" />
    </resultMap>

    <insert id="insertShop" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_shop(name,telephone,address,desc,cover_img,content,category)
        VALUES (#{name},#{telephone},#{address},#{desc},#{coverImg},#{content},#{category})
    </insert>

    <update id="updateShop">
        UPDATE t_shop
        SET name = #{name}
            ,telephone = #{telephone}
            ,address = #{address}
            ,desc = #{desc}
            ,cover_img = #{coverImg}
            ,content = #{content}
            ,category = #{category}
        WHERE id = #{id}
    </update>

    <update id="deleteShop">
        UPDATE t_shop
        SET is_deleted = TRUE
        WHERE id = #{id}
    </update>

    <select id="selectPageList" resultMap="ShopResultMap">
        SELECT name,telephone,address,desc,cover_img,category
        FROM t_shop
        WHERE is_deleted = FALSE
        <if test="category != null and category != ''">
            AND category = #{category}
        </if>
        ORDER BY create_time DESC, is_top DESC
        LIMIT #{start},#{pageSize}
    </select>

    <select id="selectCount" resultType="int">
        SELECT count(1)
        FROM t_shop
        WHERE is_deleted = FALSE
        <if test="category != null and category != ''">
            AND category = #{category}
        </if>
    </select>

    <select id="selectById" resultMap="ShopResultMap">
        SELECT name,telephone,address,desc,cover_img,content,category
        FROM t_shop
        WHERE id = #{id}
        AND is_deleted = FALSE
    </select>

    <update id="updateTopStatus">
        UPDATE t_shop
        SET is_top = #{status}
        WHERE id = #{id}
    </update>
</mapper>